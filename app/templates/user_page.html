{% extends "Base.html" %}
{% load app_tags %}
{% load static %}

{% block content %}
    <div class="container-fluid">
        <div class="container-fluid">
            {% include 'Navbar.html' %}
        </div>
    </div>
    <div class="container">
        <div class="row mt-3" style="height: 85vh; max-height: 85vh">
            <div class="col-3">
                <div class="row">
                    <img src="{% static 'assets/img/avatars/'|add:user.profile_pic_path %}"
                         class="rounded-circle w-50 mt-5 mx-auto"
                         alt="User profile avatar">
                </div>
                <div class="row mt-3 text-center">
                    <h5>{{ user.first_name }} {{ user.last_name }}</h5>
                    <p class="text-secondary">112 followers</p>
                </div>
                <div class="row mt-2 text-center">
                    <div class="col">
                        <button class="btn btn-outline-primary px-3 mx-auto"><i class="bi bi-person-plus"
                                                                                style="font-size: 1.25rem"></i> Follow
                        </button>
                    </div>
                </div>
            </div>
            <div class="col-8">
                <ul class="nav nav-tabs" id="user_tab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link text-white bg-dark active" id="watched-tab" data-bs-toggle="tab"
                                data-bs-target="#watched"
                                type="button" role="tab" aria-controls="watched" aria-selected="true">Watched list
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link text-white bg-dark" id="reviews-tab" data-bs-toggle="tab"
                                data-bs-target="#reviews"
                                type="button" role="tab" aria-controls="reviews" aria-selected="false">Reviews
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link text-white bg-dark" id="genres-tab" data-bs-toggle="tab"
                                data-bs-target="#genres"
                                type="button" role="tab" aria-controls="genres" aria-selected="false">Favorites Genres
                        </button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link text-white bg-dark" id="activities-tab" data-bs-toggle="tab"
                                data-bs-target="#activities"
                                type="button" role="tab" aria-controls="activities" aria-selected="false">Last
                            Activities
                        </button>
                    </li>
                    <li class="ms-auto" role="presentation">
                        <span class="text-secondary">Filter by : </span>
                        <select class="bg-dark text-white">
                            <option>Name</option>
                            <option>Date</option>
                        </select>
                    </li>
                </ul>
                <div class="tab-content" id="userTabContent"
                     style="overflow-y: auto; overflow-x: hidden; max-height: 80vh">
                    <div class="tab-pane fade show active" id="watched" role="tabpanel" aria-labelledby="watched-tab">
                        {% for movie in user.watched_list %}
                            <div class="row mt-3 ms-3">
                                <div class="col-2">
                                    <img src="https://image.tmdb.org/t/p/w500/{{ movie.poster_path }}"
                                         height="150px">
                                </div>
                                <div class="col-9">
                                    <h5><a href="{% url 'movie_details' movie|mongo_id %}"
                                           class="text-white"><u>{{ movie.title }}</u></a> - <span
                                            class="text-secondary">{{ movie.directors.0.name }} (
                                        {% with movie.release_date|make_list as date %}
                                            {{ date|slice:":4"|join:'' }}{% endwith %})</span>
                                    </h5>
                                    <p class="text-secondary">Cast : <span
                                            class="text-white">{% for actor in movie.cast %}
                                        {{ actor.name }}, {% endfor %}</span>
                                    </p>
                                    <small>{{ movie.overview }}</small>
                                </div>
                            </div>
                            <hr>
                        {% endfor %}
                    </div>
                    <div class="tab-pane fade" id="reviews" role="tabpanel" aria-labelledby="reviews-tab">
                        {% for commented_movie in user.commented_movies %}
                            <div class="row mt-3 ms-3">
                                <div class="col-2">
                                    <img src="https://image.tmdb.org/t/p/w500/{{ commented_movie.movie.poster_path }}"
                                         height="150px">
                                    <p><a href="{% url 'movie_details' commented_movie.movie|mongo_id %}"
                                          class="text-white"><u>{{ commented_movie.movie.title }}</u></a></p>
                                </div>
                                <div class="col-9 my-auto">
                                    <h5>{{ commented_movie.comment.title }}</h5>
                                    <p>
                                        {{ commented_movie.comment.content }}
                                    </p>
                                    <span class="text-muted">{{ commented_movie.comment.date }}</span>
                                </div>
                            </div>
                            <hr class="w-75 m-auto mt-2">
                        {% endfor %}
                    </div>
                    <div class="tab-pane fade" id="genres" role="tabpanel" aria-labelledby="genres-tab">
                        <div class="row mt-3">
                            {% for genre, nb_movies in user.favorites_genres.items %}
                                <h2>{{ forloop.counter }} - <small style="font-size: 2rem">{{ genre }} </small><small
                                        class="text-muted"
                                        style="font-size: 1.5rem ">({{ nb_movies }}
                                    movies watched)</small></h2>
                                <hr>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="tab-pane fade" id="activities" role="tabpanel" aria-labelledby="activities-tab">
                        {% for activity in user.last_activities %}
                            <div class="row mt-2">
                                <div class="col-9">
                                    {% if activity.action == "review" %}
                                        <p class="text-secondary"><span
                                                class="text-white">{{ user.first_name }} {{ user.last_name }}</span> has
                                            posted
                                            a <a class="text-white" href="{{ activity.review_id }}"><u>review</u></a>
                                            to <a href="{% url 'movie_details' activity.movie.id %}"
                                                  class="text-white"><u>{{ activity.movie.title }}</u></a></p>

                                    {% else %}
                                        <p class="text-secondary"><span
                                                class="text-white">{{ user.first_name }} {{ user.last_name }}</span> has
                                            {{ activity.action }} <a
                                                    href="{% url 'movie_details' activity.movie.id %}"
                                                    class="text-white"><u>{{ activity.movie.title }}</u></a></p>
                                    {% endif %}
                                </div>
                                <div class="col-2">
                                    <p>{{ activity.date }}</p>
                                </div>
                                <hr>
                            </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}